<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zpet.ms_invoice.mapper.InvoiceMapper">

    <select id="maxId" resultType="java.lang.Integer">
        SELECT MAX(INV_ID) FROM invoice
    </select>

    <select id="getInvoices" parameterType="map" resultType="com.zpet.ms_invoice.model.Invoice">
        SELECT 
            INV_ID as id
            , SF_ID as shippingId
            , P_ID as petId
            , STF_ID as staffId
            , CTM_ID as customerId
            , ADR_ID as adressId
            , VOU_ID as voucherId
            , INV_TOTAL as total
            , INV_CREATEDAT as createTime
        FROM invoice
        WHERE CTM_ID = #{customerId}
    </select>

    <insert id="create" parameterType="com.zpet.ms_invoice.request.InvoiceCreateRequest">
        INSERT INTO invoice (INV_ID, INV_TOTAL, INV_CREATEDAT, STF_ID, CTM_ID, VOU_ID, ADR_ID, SF_ID)
        VALUES (#{id}, #{total}, NOW() , #{staffId}, #{customerId}, #{voucherId}, #{addressId}, #{shipFeeId})
    </insert>

    <insert id="addServiceIncluded" parameterType="map">
        INSERT INTO srv_included (INV_ID, SRV_ID) VALUES (#{invId}, #{srvId})
    </insert>

</mapper>